function latepoint_init_booking_messages_file_upload(){jQuery("body").on("click",".os-bm-upload-file-btn",(function(e){var o,s=jQuery(this).closest(".os-booking-messages-input-w");return e.preventDefault(),o?(o.open(),!1):((o=wp.media({title:"Select or Upload Media",button:{text:"Use this media"},multiple:!1})).on("select",(function(){var e=o.state().get("selection").first().toJSON(),t=s.data("avatar-url");jQuery(".booking-messages-wrapper .booking-messages-list").append('<div class="os-booking-message-attachment-w os-bm-agent"><div class="os-booking-message-attachment"><i class="latepoint-icon latepoint-icon-paperclip"></i><span>'+e.filename+'</span></div><div class="os-bm-info-w"><div class="os-bm-avatar" style="background-image:url('+t+');"></div><div class="os-bm-date">'+latepoint_helper.string_today+"</div></div></div>").scrollTop(jQuery(".booking-messages-wrapper .booking-messages-list")[0].scrollHeight);var a={message:{content:e.id,content_type:"attachment",author_type:s.data("author-type"),booking_id:s.data("booking-id")}},i={action:"latepoint_route_call",route_name:s.data("route"),params:a,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:i,success:function(e){s.find(".latepoint-btn").removeClass("os-loading"),"success"===e.status||alert(e.message)}})})),o.open(),!1)}))}function latepoint_send_booking_message(e){var o=e.find(".os-booking-messages-input"),s=o.val(),t={message:{content:s,author_type:e.data("author-type"),booking_id:e.data("booking-id")}},a={action:"latepoint_route_call",route_name:e.data("route"),params:t,return_format:"json"};e.find(".latepoint-btn").addClass("os-loading"),jQuery(".booking-messages-wrapper").find(".os-bm-no-messages").remove();var i=e.data("avatar-url");return jQuery(".booking-messages-wrapper .booking-messages-list").append('<div class="os-booking-message-w os-bm-agent"><div class="os-booking-message">'+s+'</div><div class="os-bm-info-w"><div class="os-bm-avatar" style="background-image:url('+i+');"></div><div class="os-bm-date">'+latepoint_helper.string_today+"</div></div></div>"),latepoint_admin_messages_scroll_chat(),o.val(""),jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:function(t){e.removeClass("os-is-typing"),e.find(".latepoint-btn").removeClass("os-loading"),"success"===t.status||(o.val(s),alert(t.message))}}),!1}function latepoint_init_booking_messages(){latepoint_init_booking_messages_file_upload(),clearInterval(latepoint_helper.latepoint_message_refresh_timer),jQuery("body").on("click",".os-bm-send-btn",(function(e){return latepoint_send_booking_message(jQuery(this).closest(".os-booking-messages-input-w")),!1})),jQuery("body").on("keyup",".os-booking-messages-input",(function(e){var o=jQuery(this),s=o.closest(".os-booking-messages-input-w");if(13==e.keyCode)return e.preventDefault(),latepoint_send_booking_message(s),!1;o.val()?s.addClass("os-is-typing"):s.removeClass("os-is-typing")})),latepoint_helper.latepoint_message_refresh_timer=setInterval((function(){if(!document.hidden&&jQuery(".booking-messages-wrapper").length){var e=jQuery(".booking-messages-wrapper"),o={action:"latepoint_route_call",route_name:e.data("check-unread-route"),params:{booking_id:e.find(".os-booking-messages-input-w").data("booking-id"),viewer_user_type:"backend_user"},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:o,success:function(e){"success"===e.status&&"yes"==e.message&&latepoint_admin_reload_chat_messages()}})}}),3e3)}function latepoint_init_loaded_coversation(e){jQuery(".os-conversation-box.is-selected").removeClass("is-selected"),e.addClass("is-selected").removeClass("is-new").addClass("is-read"),jQuery(".os-booking-messages-input-w").data("booking-id",e.data("booking-id")),jQuery(".os-conversations-wrapper").removeClass("mobile-show-conversations").removeClass("mobile-show-booking-info"),jQuery(".os-conversations-wrapper .booking-messages-list").scrollTop(jQuery(".os-conversations-wrapper .booking-messages-list")[0].scrollHeight)}function latepoint_admin_reload_chat_messages(){var e=jQuery(".booking-messages-wrapper"),o={action:"latepoint_route_call",route_name:e.data("route"),params:{booking_id:e.find(".os-booking-messages-input-w").data("booking-id"),viewer_user_type:"backend_user"},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:o,success:function(o){"success"===o.status?(e.find(".booking-messages-list").html(o.message),latepoint_admin_messages_scroll_chat()):alert(o.message)}})}function latepoint_admin_messages_scroll_chat(){jQuery(".booking-messages-wrapper .booking-messages-list").length&&jQuery(".booking-messages-wrapper .booking-messages-list").scrollTop(jQuery(".booking-messages-wrapper .booking-messages-list")[0].scrollHeight),jQuery(".os-conversations-wrapper .booking-messages-list").length&&jQuery(".os-conversations-wrapper .booking-messages-list").scrollTop(jQuery(".os-conversations-wrapper .booking-messages-list")[0].scrollHeight)}function latepoint_init_booking_messages_panel(){jQuery(".latepoint-admin").on("click",".os-bm-open-quick-messages",(function(){var e=jQuery(this),o=e.closest(".booking-messages-info-w");e.addClass("os-loading");var s={action:"latepoint_route_call",route_name:o.data("route"),params:{booking_id:o.data("booking-id")},return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:s,success:function(o){e.removeClass("os-loading"),"success"===o.status?(jQuery(".latepoint-side-panel-w .side-sub-panel").length?jQuery(".latepoint-side-panel-w .side-sub-panel").replaceWith(o.message):jQuery(".latepoint-side-panel-w").append(o.message),latepoint_admin_messages_scroll_chat(),latepoint_init_booking_messages(),jQuery(".os-booking-messages-input").trigger("focus")):alert(o.message,"error")}})}))}function latepoint_webhook_removed(e){e.closest(".os-webhook-form").remove()}function latepoint_webhook_updated(e){location.reload()}function latepoint_init_webhooks_form(){jQuery(".latepoint-content-w").on("click",".os-webhook-form-info",(function(){return jQuery(this).closest(".os-webhook-form").toggleClass("os-is-editing"),!1})),jQuery(".latepoint-content-w").on("change","select.os-webhook-type-select",(function(){"select"==jQuery(this).val()?jQuery(this).closest(".os-webhook-form").find(".os-webhook-select-values").show():jQuery(this).closest(".os-webhook-form").find(".os-webhook-select-values").hide()})),jQuery(".latepoint-content-w").on("keyup",".os-webhook-name-input",(function(){jQuery(this).closest(".os-webhook-form").find(".os-webhook-name").text(jQuery(this).val())}))}jQuery(document).ready((function($){jQuery("body").on("click",".latepoint-messages-panel-close",(function(){return jQuery(".booking-messages-panel").remove(),!1})),jQuery(".os-conversations-wrapper").on("click",".os-toggle-conversations-panel",(function(){jQuery(".os-conversations-wrapper").toggleClass("mobile-show-conversations")})),jQuery(".os-conversations-wrapper").on("click",".os-toggle-conversation-booking-info-panel",(function(){jQuery(".os-conversations-wrapper").toggleClass("mobile-show-booking-info")})),latepoint_init_booking_messages_panel(),jQuery(".os-conversations-wrapper").length&&(latepoint_admin_messages_scroll_chat(),latepoint_init_booking_messages(),jQuery(".os-booking-messages-input").trigger("focus")),$(".osc-search-input").on("keyup",(function(e){if(27==e.which)$(this).val(""),$(".os-search-conversations-list").html("").hide(),$(".os-conversations-list").show(),o.closest(".osc-search-wrapper").removeClass("os-loading");else{var o=$(this);if(!o.val())return $(".os-search-conversations-list").html("").hide(),$(".os-conversations-list").show(),o.closest(".osc-search-wrapper").removeClass("os-loading"),!1;var s={action:"latepoint_route_call",route_name:$(this).data("route"),params:{query:o.val()},layout:"none",return_format:"json"};o.closest(".osc-search-wrapper").addClass("os-loading"),$.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:s,success:function(e){if(!o.val())return $(".os-search-conversations-list").html("").hide(),$(".os-conversations-list").show(),!1;o.closest(".osc-search-wrapper").removeClass("os-loading"),"success"===e.status&&($(".os-search-conversations-list").html(e.message).show(),$(".os-conversations-list").hide())}})}}))})),function($){"use strict";jQuery((function(){latepoint_init_webhooks_form()}))}();class LatepointServiceExtrasAdminAddon{constructor(){this.ready()}reload_service_extras_on_quick_form(e){e.find(".latepoint-service-extras-for-booking-wrapper").addClass("os-loading");var o=e.find(".latepoint-service-extras-for-booking-wrapper").data("route-name"),s=new FormData(e.closest(".order-quick-edit-form")[0]);s.append("order_item_id",e.data("order-item-id")),s.append("booking_id",e.data("booking-id"));var t={action:latepoint_helper.route_action,route_name:o,params:latepoint_formdata_to_url_encoded_string(s),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:t,success:o=>{e.find(".latepoint-service-extras-for-booking-wrapper").removeClass("os-loading"),o.status===latepoint_helper.response_status.success?(e.find(".latepoint-service-extras-for-booking-wrapper").html(o.message),e.find(".latepoint-service-extras-for-booking-wrapper .os-late-select").lateSelect()):alert("Error!")}})}ready(){jQuery((()=>{jQuery("body").on("latepoint:initBookingDataForm",".quick-order-form-w",(e=>{jQuery(e.target).find(".os-affects-service-extras").on("change",(e=>{this.reload_service_extras_on_quick_form(jQuery(e.target).closest(".order-item-booking-data-form-wrapper"))})),jQuery(e.target).on("click",".clear-lateselect",(function(){jQuery("#"+jQuery(this).data("lateselect-id")).val("").closest(".os-form-group").find("select").trigger("change"),jQuery(".clear-missing-lateselect").remove()}))}))}))}}window.latepointServiceExtrasAdminAddon=new LatepointServiceExtrasAdminAddon;class LatepointRoleManagerAddonAdmin{constructor(){this.ready()}ready(){jQuery((()=>{}))}role_deleted(e){e.closest(".os-form-block").remove()}init_edit_wp_user_form(){let e=jQuery(".role-user-edit-form");e.find(".os-late-select").lateSelect(),e.find("select.allowed_models_selector").on("change",(function(){jQuery(this).val()==latepoint_helper.value_all?jQuery(this).closest(".os-form-group").next("div").hide():jQuery(this).closest(".os-form-group").next("div").show()})),e.find("input#custom_capabilities").on("change",(function(){"on"==jQuery(this).val()?(e.find(".custom-user-capabilities-w").show(),e.find(".default-user-capabilities-w").hide()):(e.find(".custom-user-capabilities-w").hide(),e.find(".default-user-capabilities-w").show())}))}init_new_role_form(){let e=jQuery(".os-custom-roles-w .os-form-block:last-child");e.addClass("os-is-editing").find('input[name="role[name]"]').trigger("select"),this.init_role_form(e)}init_role_form(e){e.find('input[name="role[name]"]').on("keyup",(function(){e.find(".update-from-name").text(jQuery(this).val())}))}}window.latepointRoleManagerAddonAdmin=new LatepointRoleManagerAddonAdmin;class LatepointTaxesAddon{constructor(){this.ready()}init_new_tax_form(){this.init_tax_value_format(jQuery(".os-taxes-w .os-form-block:last-child"))}init_tax_value_format(e){"fixed"==e.find(".tax-type-selector").val()&&e.find(".tax-value").length&&latepoint_mask_money(e.find(".tax-value")),"percentage"==e.find(".tax-type-selector").val()&&e.find(".tax-value").length&&latepoint_mask_percent(e.find(".tax-value"))}latepoint_tax_removed(e){e.closest(".os-form-block").remove()}init_tax_forms(){jQuery(".os-taxes-w .os-form-block").each(((e,o)=>{this.init_tax_value_format(jQuery(o))}))}ready(){jQuery(document).ready((()=>{this.init_tax_forms(),jQuery(".latepoint-content").on("change",".tax-type-selector",(e=>{let o=jQuery(e.currentTarget),s=o.closest(".os-form-block");s.find(".os-form-block-type").text(o.val()),this.init_tax_value_format(s)}))}))}}window.latepointTaxesAddon=new LatepointTaxesAddon;class LatepointCouponsAddon{constructor(){this.ready()}ready(){jQuery(document).ready((()=>{jQuery("body.latepoint-admin").on("click",".quick-order-form-w .apply-coupon-button",(function(){return latepoint_reload_price_breakdown(),!1})),jQuery("body.latepoint-admin").on("change",".quick-order-form-w #apply_coupon_toggler",(function(){"off"==jQuery(this).val()&&(jQuery("#order_coupon_code").val(""),latepoint_reload_price_breakdown())}))}))}}window.latepointCouponsAddon=new LatepointCouponsAddon;class LatepointCustomFieldsAdminAddon{constructor(){this.ready()}init_new_custom_field_form(){this.init_custom_fields_conditions_form()}add_custom_field_condition(e,o){e.closest(".cf-condition").after(o.message),this.init_custom_fields_conditions_form()}init_google_places_autosuggest(e){e.find(".latepoint-google-places-autocomplete").length&&("undefined"!=typeof google?e.find(".latepoint-google-places-autocomplete").each(((e,o)=>{if(jQuery(o).hasClass("os-initialized"))return!0;const s={fields:["formatted_address"]};latepoint_helper.google_places_country_restriction&&(s.componentRestrictions={country:latepoint_helper.google_places_country_restriction});new google.maps.places.Autocomplete(o,s);jQuery(o).addClass("os-initialized")})):console.error("Error loading Google API library"))}init_custom_fields_conditions_form(){jQuery(".os-late-select").lateSelect()}init_file_upload_fields(e){e.find(".os-form-file-upload-group").each((function(){if(jQuery(this).hasClass("os-initialized"))return!0;jQuery(this).on("click",".os-uploaded-file-info",(function(){if(!jQuery(this).hasClass("is-uploaded"))return!1})),jQuery(this).on("click",".uf-remove",(function(){var e=jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info"),o=jQuery(this).closest(".os-form-group").find('input[type="file"]');if(o.hasClass("required")&&e.has("is-uploaded"))confirm(latepoint_helper.custom_fields_remove_required_file_prompt)&&o.trigger("click");else{if(e.hasClass("is-uploaded")){if(!confirm(latepoint_helper.custom_fields_remove_file_prompt))return!1;var s=e.closest(".os-form-group").find('input[type="file"]').data("route-name"),t=e.closest(".os-form-group").find('input[type="file"]').data("params"),a={action:latepoint_helper.route_action,route_name:s,params:t,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:function(o){"success"===o.status&&e.closest(".os-form-group").find('input[type="hidden"]').remove()}})}jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").hide(),o.val(null).trigger("change")}return!1})),jQuery(this).on("change",'input[type="file"]',(function(){this.files.length?(jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").show().attr("href","#").attr("target","_self").find(".uf-name").text(this.files[0].name),jQuery(this).closest(".os-form-group").find(".os-upload-file-input-w").hide()):(jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").hide().removeClass("is-uploaded"),jQuery(this).closest(".os-form-group").find(".os-upload-file-input-w").show())})),jQuery(this).addClass("os-initialized")}))}reload_conditional_custom_fields_on_booking_data_form(e){e.find(".latepoint-custom-fields-for-booking-wrapper").each(((e,o)=>{let s=jQuery(o),t=s.closest(".order-item-booking-data-form-wrapper");s.addClass("os-loading");var a=s.data("route-name"),i=new FormData(t.closest(".order-quick-edit-form")[0]);i.append("order_item_id",t.data("order-item-id")),i.append("booking_id",t.data("booking-id"));var n={action:latepoint_helper.route_action,route_name:a,params:latepoint_formdata_to_url_encoded_string(i),return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:n,success:e=>{s.removeClass("os-loading"),e.status===latepoint_helper.response_status.success?(s.html(e.message),latepoint_init_input_masks(s),this.init_google_places_autosuggest(s)):alert("Error!")}})}))}ready(){jQuery((()=>{this.init_custom_fields_conditions_form();let e=jQuery(".customer-form-wrapper");e.length&&(this.init_file_upload_fields(e),this.init_google_places_autosuggest(e));let o=this;jQuery(".latepoint-content-w").on("change","select.os-form-block-type-select",(function(){switch(jQuery(this).closest(".os-form-block").find(".custom-fields-google-places-api-status, .custom-fields-select-values").hide(),jQuery(this).val()){case"select":jQuery(this).closest(".os-form-block").find(".custom-fields-select-values").show();break;case"google_address_autocomplete":jQuery(this).closest(".os-form-block").find(".custom-fields-google-places-api-status").show()}o.init_custom_fields_default_value_field(jQuery(this))})),jQuery("body").on("latepoint:initInputMasks",".quick-order-form-w",(e=>{this.init_file_upload_fields(jQuery(e.target)),this.init_google_places_autosuggest(jQuery(e.target))})),jQuery("body").on("latepoint:initBookingDataForm",".quick-order-form-w",(e=>{let o=jQuery(e.target);this.init_file_upload_fields(o),this.init_google_places_autosuggest(o),o.find(".os-affects-custom-fields").on("change",(e=>{this.reload_conditional_custom_fields_on_booking_data_form(o)}))})),jQuery(".os-custom-fields-w").on("change","select.custom-field-condition-property",(e=>{var o=jQuery(e.currentTarget),s={property:o.val(),custom_field_id:o.closest(".os-form-block").data("os-form-block-id"),condition_id:o.closest(".cf-condition").data("condition-id")},t=o.data("route"),a={action:latepoint_helper.route_action,route_name:t,params:s,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:e=>{e.status===latepoint_helper.response_status.success?(o.closest(".cf-condition").find(".custom-field-condition-values-w").replaceWith(e.message),this.init_custom_fields_conditions_form()):alert("Error!")}})})),jQuery(".os-custom-fields-w").on("click",".cf-remove-condition",(e=>(jQuery(e.currentTarget).closest(".cf-conditions").find(".cf-condition").length>1?jQuery(e.currentTarget).closest(".cf-condition").remove():alert("You need to have at least one condition if your custom field is set to be conditional."),!1))),this.init_custom_fields_conditions_form()}))}init_custom_fields_default_value_field(e){const o=e.val();let s=e.closest(".os-form-block"),t=s.find(`*[name="custom_fields[${s.data("os-form-block-id")}][value]"]`),a=t.closest(".custom-fields-default-value-row");if(JSON.parse(latepoint_helper.custom_field_types_with_default_value).includes(o)){let o={field_type:e.val(),field_name:`custom_fields[${s.data("os-form-block-id")}][value]`,field_value:t.val()},i={action:latepoint_helper.route_action,route_name:latepoint_helper.custom_field_default_value_field_html_route,params:o,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:i,success:e=>{e.status===latepoint_helper.response_status.success?(t.closest(".os-form-group").replaceWith(e.message),a.show(),latepoint_init_input_masks(s)):(t.val(""),a.hide(),alert(e.message))}})}else t.val(""),a.hide()}}window.latepointCustomFieldsAdminAddon=new LatepointCustomFieldsAdminAddon;