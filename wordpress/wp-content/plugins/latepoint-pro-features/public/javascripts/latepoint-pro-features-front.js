!function($){"use strict";function e(e){var o=e.find(".os-booking-messages-input"),s=o.val(),a={message:{content:s,author_type:e.data("author-type"),booking_id:e.data("booking-id")}},i={action:"latepoint_route_call",route_name:e.data("route"),params:a,return_format:"json"};e.find(".latepoint-btn").addClass("os-loading"),$(".booking-messages-list").find(".os-bm-no-messages").remove();var n=e.data("avatar-url");return $(".booking-messages-list").append('<div class="os-booking-message-w os-bm-customer"><div class="os-booking-message">'+s+'</div><div class="os-bm-info-w"><div class="os-bm-avatar" style="background-image:url('+n+');"></div><div class="os-bm-date">'+latepoint_helper.string_today+"</div></div></div>"),t(),o.val(""),$.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:i,success:function(t){e.removeClass("os-is-typing"),e.find(".latepoint-btn").removeClass("os-loading"),"success"===t.status||(o.val(s),alert(t.message))}}),!1}function t(){jQuery(".booking-messages-list").scrollTop(jQuery(".booking-messages-list")[0].scrollHeight)}function o(e,o){var s=$(".latepoint-chat-box-w");o&&s.addClass("os-loading");var a={action:"latepoint_route_call",route_name:s.data("route"),params:{booking_id:e,viewer_user_type:"customer"},return_format:"json"};$.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:function(a){o&&s.removeClass("os-loading"),"success"===a.status?(s.find(".booking-messages-list").html(a.message),t(),$(".os-booking-messages-input-w").data("booking-id",e)):alert(a.message)}})}$((function(){$(".lc-conversation").on("click",(function(){var e=$(this).data("booking-id");return $(".lc-conversation.lc-selected").removeClass("lc-selected"),$(this).addClass("lc-selected"),o(e,!0),!1})),clearInterval(latepoint_helper.latepoint_message_refresh_timer),$(".latepoint-chat-box-w").length&&$(".lc-conversation").length&&(latepoint_helper.latepoint_message_refresh_timer=setInterval((function(){if(!document.hidden){var e={action:"latepoint_route_call",route_name:$(".latepoint-chat-box-w").data("check-unread-route"),params:{booking_id:$(".lc-conversation.lc-selected").data("booking-id"),viewer_user_type:"customer"},return_format:"json"};$.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:e,success:function(e){"success"===e.status&&"yes"==e.message&&o($(".lc-conversation.lc-selected").data("booking-id"),!1)}})}}),3e3)),$(".os-bm-send-btn").on("click",(function(t){return e($(this).closest(".os-booking-messages-input-w")),!1})),$(".os-booking-messages-input").on("keyup",(function(t){var o=$(this),s=o.closest(".os-booking-messages-input-w");if(13==t.keyCode)return t.preventDefault(),e(s),!1;o.val()?s.addClass("os-is-typing"):s.removeClass("os-is-typing")})),$(".latepoint-trigger-messages-tab").on("click",(function(){o($(".lc-conversation.lc-selected").data("booking-id"),!1)}))}))}(jQuery);class LatepointCustomFieldsFrontAddon{constructor(){this.ready()}init_google_places_autosuggest(e){e.find(".latepoint-google-places-autocomplete").length&&("undefined"!=typeof google?e.find(".latepoint-google-places-autocomplete").each(((e,t)=>{if(jQuery(t).hasClass("os-initialized"))return!0;const o={fields:["formatted_address"]};latepoint_helper.google_places_country_restriction&&(o.componentRestrictions={country:latepoint_helper.google_places_country_restriction});new google.maps.places.Autocomplete(t,o);jQuery(t).addClass("os-initialized")})):console.error("Error loading Google API library"))}init_file_upload_fields(e){e.find(".os-form-file-upload-group").each((function(){if(jQuery(this).hasClass("os-initialized"))return!0;jQuery(this).on("click",".os-uploaded-file-info",(function(){if(!jQuery(this).hasClass("is-uploaded"))return!1})),jQuery(this).on("click",".uf-remove",(function(){var e=jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info"),t=jQuery(this).closest(".os-form-group").find('input[type="file"]');if(t.hasClass("required")&&e.has("is-uploaded"))confirm(latepoint_helper.custom_fields_remove_required_file_prompt)&&t.trigger("click");else{if(e.hasClass("is-uploaded")){if(!confirm(latepoint_helper.custom_fields_remove_file_prompt))return!1;var o=e.closest(".os-form-group").find('input[type="file"]').data("route-name"),s=e.closest(".os-form-group").find('input[type="file"]').data("params"),a={action:latepoint_helper.route_action,route_name:o,params:s,return_format:"json"};jQuery.ajax({type:"post",dataType:"json",url:latepoint_helper.ajaxurl,data:a,success:function(t){"success"===t.status&&e.closest(".os-form-group").find('input[type="hidden"]').remove()}})}jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").hide(),t.val(null).trigger("change")}return!1})),jQuery(this).on("change",'input[type="file"]',(function(){this.files.length?(jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").show().attr("href","#").attr("target","_self").find(".uf-name").text(this.files[0].name),jQuery(this).closest(".os-form-group").find(".os-upload-file-input-w").hide()):(jQuery(this).closest(".os-form-group").find(".os-uploaded-file-info").hide().removeClass("is-uploaded"),jQuery(this).closest(".os-form-group").find(".os-upload-file-input-w").show())}))}))}ready(){jQuery(document).ready((()=>{let e=jQuery(".tab-content-customer-info-form");e.length&&(this.init_file_upload_fields(e),this.init_google_places_autosuggest(e)),jQuery("body").on("latepoint:initStep",".latepoint-booking-form-element",((e,t)=>{var o=jQuery('.latepoint-step-content[data-step-code="'+t.step_code+'"]');this.init_file_upload_fields(o),this.init_google_places_autosuggest(o),latepoint_init_form_masks()}))}))}}window.latepointCustomFieldsFrontAddon=new LatepointCustomFieldsFrontAddon;class LatepointGroupBookingsFrontFeature{constructor(){this.ready()}init_total_attendees_selector(e){}ready(){jQuery(document).ready((()=>{jQuery("body").on("latepoint:initStep:booking__group_bookings",".latepoint-booking-form-element",((e,t)=>{let o=jQuery('.latepoint-step-content[data-step-code="booking__group_bookings"]');o.on("change",".total-attendees-selector-input",(function(){let e=jQuery(this).closest(".total-attendees-selector-w").data("max-capacity"),t=jQuery(this).closest(".total-attendees-selector-w").data("min-capacity"),o=jQuery(this).val();o=Math.min(Number(e),Number(o)),o=Math.max(Number(t),Number(o)),jQuery(this).val(o);o>1?jQuery(this).data("summary-plural"):jQuery(this).data("summary-singular");let s=jQuery(this).closest(".latepoint-booking-form-element");latepoint_reload_summary(s)})),o.on("click",".total-attendees-selector",(function(){let e=jQuery(this).hasClass("total-attendees-selector-plus")?1:-1,t=jQuery(this).closest(".total-attendees-selector-w").data("max-capacity"),o=jQuery(this).closest(".total-attendees-selector-w").data("min-capacity"),s=jQuery(this).closest(".total-attendees-selector-w").find("input.total-attendees-selector-input").val(),a=Number(s)>0?Math.max(Number(s)+e,1):1;return a=Math.min(Number(t),a),a=Math.max(Number(o),a),jQuery(this).closest(".total-attendees-selector-w").find("input").val(a).trigger("change"),!1}))}))}))}}window.latepointGroupBookingsFrontFeature=new LatepointGroupBookingsFrontFeature;